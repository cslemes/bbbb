#Use an Ubuntu 18.04 base for our staging server
#For host in webapp.io
FROM vm/ubuntu:18.04

# To note: Layerfiles create entire VMs, *not* containers!

# Install go

RUN wget https://go.dev/dl/go1.23.1.linux-amd64.tar.gz
RUN tar -C /usr/local -xzf go1.23.1.linux-amd64.tar.gz
RUN ln -s /usr/local/go/bin/go /usr/local/bin/go


# build app
COPY . .
RUN go mod tidy
RUN go build -o sshblog cmd/ssh/*
RUN go build -o httpsv http/main.go


RUN echo "$TSKEY" | base64 -d > .env
# Expose the webserver in the staging server as a secure link.
# Whenever someone clicks the link, we'll load this staging server and forward
# their requests to it.

RUN BACKGROUND ./sshblog
RUN BACKGROUND ./httpsv
EXPOSE WEBSITE localhost:80
