#Use an Ubuntu 18.04 base for our staging server
#For host in webapp.io
FROM vm/ubuntu:18.04

# To note: Layerfiles create entire VMs, *not* containers!

# Install go
## RUN apt-get update && apt-get install tar
RUN wget https://go.dev/dl/go1.23.1.linux-amd64.tar.gz
RUN tar -C /usr/local -xzf go1.23.1.linux-amd64.tar.gz
RUN ln -s /usr/local/go/bin/go /usr/local/bin/go


# build app
COPY . .
RUN go mod tidy
RUN go build -o cris_term cmd/ssh/*


# Expose the webserver in the staging server as a secure link.
# Whenever someone clicks the link, we'll load this staging server and forward
# their requests to it.
RUN BACKGROUND ./cris_term
# EXPOSE WEBSITE localhost:22 /ssh
EXPOSE WEBSITE ssh://localhost:42069
